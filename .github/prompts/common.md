# MiniDB代码生成与优化提示

## 快速开始提示

### 创建新模块
```
@workspace 基于MiniDB项目结构，帮我创建一个新的{module_name}模块，实现{functionality}功能。请遵循项目的编码规范和架构模式。
```

### 实现数据结构
```
为MiniDB实现一个{data_structure_name}数据结构，支持{operations}操作，优化{performance_aspect}性能。请包含完整的错误处理和测试。
```

### 优化现有代码
```
@workspace 分析并优化以下MiniDB代码的{aspect}性能：
{code}

重点关注{specific_concerns}。
```

## SQL编译器相关提示

### 词法分析器
```
为MiniDB SQL编译器实现词法分析器，支持以下Token类型：
- SQL关键字（SELECT, FROM, WHERE等）
- 标识符和字面量
- 操作符和分隔符
- 注释处理

请包含错误位置信息和流式处理支持。
```

### 语法分析器
```
实现MiniDB的SQL语法分析器，使用递归下降解析方法，支持：
- SELECT语句（包括JOIN, WHERE, GROUP BY, ORDER BY）
- INSERT/UPDATE/DELETE语句
- CREATE/DROP TABLE语句

生成类型安全的AST，包含位置信息。
```

### 查询优化器
```
为MiniDB实现基于规则的查询优化器，支持：
- 谓词下推（Predicate Pushdown）
- 投影下推（Projection Pushdown）
- 连接重排序
- 索引选择

请使用访问者模式遍历和转换查询计划。
```

## 存储引擎相关提示

### 页面管理器
```
实现MiniDB的页面管理器，特性包括：
- 4KB固定页面大小
- 页面头包含元数据和校验和
- 支持不同页面类型（数据页、索引页、元数据页）
- 线程安全的页面访问

请实现完整的错误处理和并发控制。
```

### 缓冲池管理
```
为MiniDB实现高效的缓冲池管理器：
- LRU替换策略
- 脏页管理和延迟写入
- 页面固定/取消固定机制
- 预取支持

重点优化并发性能和内存效率。
```

### B+树索引
```
实现MiniDB的B+树索引结构：
- 支持范围查询和点查询
- 并发插入和删除
- 页面分裂和合并
- 索引统计信息收集

请确保事务安全和崩溃恢复兼容性。
```

## 查询执行相关提示

### 执行器框架
```
设计MiniDB的查询执行器框架：
- 火山模型（Volcano Model）迭代器接口
- 支持基本算子：TableScan, IndexScan, Join, Aggregation, Sort
- 内存管理和溢出处理
- 执行统计信息收集

请实现可扩展的算子注册机制。
```

### 哈希连接实现
```
为MiniDB实现高效的哈希连接算子：
- 构建阶段和探测阶段
- 内存不足时的磁盘溢出
- 支持内连接和外连接
- 优化小表作为构建端

关注内存使用效率和缓存友好性。
```

### 聚合算子
```
实现MiniDB的聚合算子，支持：
- 基本聚合函数：COUNT, SUM, AVG, MIN, MAX
- 哈希聚合和排序聚合
- 分组聚合（GROUP BY）
- 流式聚合优化

处理NULL值和数据类型转换。
```

## 事务处理相关提示

### 事务管理器
```
为MiniDB实现事务管理器：
- ACID事务保证
- 两阶段锁定（2PL）
- 事务ID生成和管理
- 死锁检测和处理

请实现事务状态跟踪和资源清理。
```

### 日志管理
```
实现MiniDB的WAL（Write-Ahead Logging）系统：
- 日志记录格式和序列化
- 检查点机制
- 崩溃恢复流程
- 日志文件轮转

确保数据持久性和一致性。
```

## 类型系统相关提示

### 数据类型实现
```
为MiniDB实现完整的数据类型系统：
- 基础类型：INTEGER, FLOAT, VARCHAR, BOOLEAN, DATE
- 类型转换和比较
- NULL值处理
- 序列化和反序列化

请支持类型推导和兼容性检查。
```

### 表达式求值
```
实现MiniDB的表达式求值引擎：
- 算术表达式（+, -, *, /）
- 比较表达式（=, <>, <, >, <=, >=）
- 逻辑表达式（AND, OR, NOT）
- 内置函数调用

支持类型检查和运行时求值。
```

## 性能优化提示

### SIMD优化
```
使用SIMD指令优化MiniDB的{operation}操作：
- 向量化数据处理
- 批量比较和筛选
- 聚合计算加速
- 内存带宽优化

请保持代码可移植性。
```

### 缓存优化
```
优化MiniDB的缓存性能：
- 数据结构内存布局优化
- 减少缓存缺失
- 预取策略实现
- NUMA感知优化

分析缓存友好的算法实现。
```

### 并发优化
```
提升MiniDB的并发性能：
- 锁粒度优化
- 无锁数据结构
- 读写分离
- 工作负载分区

请保证正确性的前提下最大化并发度。
```

## 测试相关提示

### 单元测试生成
```
为MiniDB的{module_name}模块生成全面的单元测试：
- 覆盖所有公共API
- 测试边界条件和异常情况
- 使用mock对象隔离依赖
- 包含性能基准测试

确保测试的可读性和维护性。
```

### 集成测试
```
创建MiniDB的端到端集成测试：
- SQL查询正确性验证
- 并发场景测试
- 故障恢复测试
- 性能回归测试

使用真实数据和工作负载。
```

### 模糊测试
```
使用proptest为MiniDB实现属性测试：
- 随机SQL语句生成
- 数据类型兼容性测试
- 并发操作一致性
- 崩溃-恢复正确性

发现边界情况和异常行为。
```

## 调试和诊断提示

### 日志系统
```
为MiniDB实现结构化日志系统：
- 分级日志（DEBUG, INFO, WARN, ERROR）
- 结构化字段和元数据
- 性能敏感路径的条件日志
- 日志聚合和分析支持

平衡调试能力和性能影响。
```

### 性能分析
```
为MiniDB添加性能分析功能：
- 查询执行时间分解
- 资源使用统计
- 热点函数识别
- 内存分配跟踪

提供可视化的性能报告。
```

### 错误诊断
```
增强MiniDB的错误诊断能力：
- 详细的错误上下文信息
- 错误传播链跟踪
- 自动化故障检测
- 恢复建议生成

帮助快速定位和解决问题。
```

## 文档生成提示

### API文档
```
为MiniDB模块生成rustdoc风格的API文档：
- 详细的类型和函数说明
- 使用示例和最佳实践
- 错误处理指导
- 性能注意事项

确保文档的准确性和实用性。
```

### 架构文档
```
创建MiniDB的架构设计文档：
- 系统整体架构图
- 模块职责和交互
- 数据流和控制流
- 关键设计决策说明

面向新开发者和维护者。
```

这些提示可以帮助你在开发MiniDB项目时更高效地使用GitHub Copilot，生成高质量的代码和文档。
